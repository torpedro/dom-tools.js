var DomListener=function(){function a(a,b){if(this.selector=a,"function"==typeof b)this.callback=b,this.callForExisting=!0,this.root=document.body;else{var c=b;this.callback=c.callback,this.onRemove=c.onRemove,this.callForExisting="callForExisting"in c?c.callForExisting:!0,this.root=c.root||document.body}this.initialize()}return a.prototype.destroy=function(){this.observer.disconnect()},a.prototype.initialize=function(){var a=this;if(this.callForExisting)for(var b=this.root.querySelectorAll(this.selector),c=0;c<b.length;++c)this.callback(b[c]);this.observer=new MutationObserver(function(b,c){a.onDomMutations(b)}),this.observer.observe(this.root,{childList:!0,subtree:!0})},a.prototype.onDomMutations=function(a){for(var b=0;b<a.length;b++){for(var c=a[b],d=0;d<c.addedNodes.length;++d){var e=c.addedNodes[d];this.onNodeAdded(e)}for(var d=0;d<c.removedNodes.length;++d){var e=c.removedNodes[d];this.onNodeRemove(e)}}},a.prototype.onNodeAdded=function(a){this.callback&&this.handleDomEvent(a,this.callback)},a.prototype.onNodeRemove=function(a){this.onRemove&&this.handleDomEvent(a,this.onRemove)},a.prototype.handleDomEvent=function(a,b){if(a.nodeType===Node.ELEMENT_NODE){var c=a;if(c.matches)c.matches(this.selector)&&b(c);else for(var d=c.parentElement.querySelectorAll(this.selector),e=0;e<d.length;++e)if(d[e]===c){b(c);break}for(var f=c.querySelectorAll(this.selector),g=0;g<f.length;++g)b(f[g])}},a}();